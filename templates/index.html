<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>全文检索</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; margin: 0; padding: 24px; background: #f6f8fa; }
    .container { max-width: 1100px; margin: 0 auto; }
    .card { background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .title { font-size: 22px; margin: 0 0 12px; }
    .search { display: flex; gap: 8px; }
    .search input[type="text"] { flex: 1; padding: 10px 12px; border: 1px solid #d0d7de; border-radius: 6px; font-size: 14px; }
    .search button { padding: 10px 16px; border: 0; border-radius: 6px; background: #0969da; color: #fff; cursor: pointer; font-size: 14px; }
    .muted { color: #57606a; font-size: 13px; }
    .result { margin-top: 16px; padding: 14px; border: 1px solid #d0d7de; border-radius: 8px; background: #fff; }
    .result-header { display: flex; flex-wrap: wrap; gap: 10px; font-size: 13px; color: #57606a; }
    .result pre { background: #f6f8fa; padding: 12px; border-radius: 6px; overflow-x: auto; }
    mark { background: #ffe58f; padding: 0 2px; }
    .pagination { display: flex; gap: 10px; margin-top: 16px; align-items: center; }
    .pagination a { text-decoration: none; color: #0969da; }
    .error { color: #d1242f; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1 class="title">全文检索</h1>
      <form class="search" method="get" action="/">
        <input type="text" name="q" placeholder="输入关键词" value="{{ q }}" />
        <input type="hidden" name="page" value="1" />
        <input type="hidden" name="size" value="{{ size }}" />
        <button type="submit">搜索</button>
      </form>
      <p class="muted">搜索所有索引与字段，支持高亮。</p>

      {% if error %}
        <p class="error">错误：{{ error }}</p>
      {% endif %}

      {% if results %}
        <p class="muted">共 {{ results.hits.total.value }} 条结果，当前第 {{ page }} 页。</p>
        {% for hit in results.hits.hits %}
          <div class="result">
            <div class="result-header">
              <div>index: <strong>{{ hit._index }}</strong></div>
              <div>id: <strong>{{ hit._id }}</strong></div>
              <div>score: <strong>{{ hit._score }}</strong></div>
            </div>
            {% if hit.highlight %}
              <div class="muted" style="margin-top:8px;">高亮：</div>
              <ul>
                {% for field, fragments in hit.highlight.items() %}
                  <li><strong>{{ field }}</strong>: {{ fragments|join(' ... ')|safe }}</li>
                {% endfor %}
              </ul>
            {% endif %}
            <pre>{{ hit._source | tojson_pretty }}</pre>
          </div>
        {% endfor %}

        <div class="pagination">
          {% if page > 1 %}
            <a href="/?q={{ q }}&page={{ page - 1 }}&size={{ size }}">上一页</a>
          {% endif %}
          <span class="muted">第 {{ page }} 页</span>
          {% if results.hits.total.value > page * size %}
            <a href="/?q={{ q }}&page={{ page + 1 }}&size={{ size }}">下一页</a>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</body>
</html>
